# 关于日志系统

1. 设计思路

   在服务器的开发中，日志系统也是不可或缺的部分。主要内容：

   - 整个服务器进程中的所有线程公用一个日志系统，所以日志系统采用单例模式。
   - 因为日志编写是IO密集型操作，而且日志写入并不要求及时性，所以将日志系统设计为异步模式，采用多生产者单消费者模式实现异步。
   - 设置了5总不同的日志级别，同时通过编写宏的方式简化写日志过程
   - 为了防止日志文件过大，日志系统每天会打开一个新的文件写入日志

2. 一些思考

   - 关于char[]和string

     对于日志的操作不可避免的得对字符串进行处理，我在这里使用的是char[]和string结合使用的方式。如果完全用string处理字符串应该会简洁一些，但是为了兼容格式化输入，好像又不可避免的需要使用char[]。在我看来使用c++处理字符串实在不是件令人愉快的事，往往需要使用很多种输入函数库，像`snprintf`、`vsnprintf`等，但很多c函数的接口只能接受字符数组，所以string看上去简化了了对字符的操作，但泛用性很差。还有我在Log.h中写的宏也是为了兼容格式化输入，其中`##__VA_ARGS__`的作用相当于可变参数模板了。

   - 关于日志系统的底层数据结构

     我这里对于生产者消费者模型中队列的数据结构采用的是`std::queue`。这个数据结构可以说是一种数组和链表结合的折中新结构，即用指针将大块的数组相连，这样可以同时拥有数组和链表的优点：既不会频繁的开辟空间，又可以方便的对数据结构扩容。但是如果对性能有着较高要求的话，其实还可以进一步提升，可以将上述数据机构设计成环状的，这样可以重复利用空间，大幅减少空间的开辟和销毁，同时还能保持可扩展性。不过这样需要重新设计编写数据结构，估计工程量非常大，所以我这里就直接用了`std::queue`。
